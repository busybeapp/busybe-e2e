name: Daily E2E Tests

on:
  schedule:
    - cron: '0 0 * * *' # Runs at midnight UTC daily
  workflow_dispatch:

jobs:
  run-e2e-tests:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18' # Use the appropriate Node.js version

    - name: Install Dependencies
      run: npm install

    - name: Run E2E Tests
      id: e2e-tests
      env:
        SLACK_TOKEN: ${{ secrets.SLACK_TOKEN }}
      run: |
        npm test || echo "Tests failed"

    - name: Send Slack Notification on Failure
      if: failure()
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
      run: |
        curl -X POST -H 'Content-type: application/json' \
        --data '{"text":"ðŸš¨ BusyBe E2E Tests failed! Check the logs for more details: $GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/${{ github.run_id }}"}' \
        $SLACK_WEBHOOK_URL
